apiVersion: v1
kind: ConfigMap
metadata:
  name: rocket-chat-dashboard-comprehensive
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  rocket-chat-dashboard-comprehensive.json: |
    {
      "uid": "rocketchat-comprehensive",
      "title": "Rocket.Chat Multi-Environment Monitoring Dashboard",
      "description": "Comprehensive monitoring dashboard for Rocket.Chat deployments across multiple environments (Production, Staging, Development, QA). Features advanced visualizations, deployment tracking, and real-time metrics.",
      "tags": ["rocket-chat", "multi-environment", "production", "monitoring", "comprehensive", "kubernetes"],
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "refresh": "30s",
      "time": {"from": "now-6h", "to": "now"},
      "timepicker": {
        "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
        "time_options": ["5m", "15m", "1h", "3h", "6h", "12h", "24h", "2d", "3d", "7d", "30d"]
      },
      "panels": [
        {
          "id": 1,
          "title": "Rocket.Chat Uptime SLO",
          "description": "Service Level Objective for Rocket.Chat availability. Measures uptime percentage across all Rocket.Chat instances.",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "editorMode": "code",
              "expr": "avg(up{job=~\".*rocketchat.*\"}) * 100",
              "range": true,
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "yellow", "value": 95},
                  {"color": "green", "value": 99}
                ]
              }
            },
            "overrides": []
          }
        },
        {
          "id": 2,
          "title": "Active Users",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_active",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "none",
            "textMode": "value"
          }
        },
        {
          "id": 3,
          "title": "Total Users",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_total",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"}
            }
          },
          "options": {
            "graphMode": "none",
            "textMode": "value"
          }
        },
        {
          "id": 4,
          "title": "Total Messages Sent",
          "description": "Total number of messages sent across all channels since deployment.",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_messages_total",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 0
            }
          },
          "options": {
            "graphMode": "none",
            "textMode": "value"
          }
        },
        {
          "id": 5,
          "title": "User Status Distribution",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_online",
              "legendFormat": "Online",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_away",
              "legendFormat": "Away",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_offline",
              "legendFormat": "Offline",
              "refId": "C"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 6,
          "title": "DDP Connected Users",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_ddp_connected_users",
              "legendFormat": "Connected Users",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 7,
          "title": "API Response Time",
          "description": "API endpoint response times by pod and HTTP method. Average response time and 95th percentile latency for REST API calls.",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_rest_api_sum[5m]) / rate(rocketchat_rest_api_count[5m])",
              "legendFormat": "Average Response Time - {{pod}} - {{method}}",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_messages_roundtrip_time_summary{quantile=\"0.95\"}",
              "legendFormat": "95th Percentile - {{pod}}",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 8,
          "title": "API Request Rate",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_rest_api_count[5m])",
              "legendFormat": "Requests/sec - {{pod}} - {{method}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "reqps",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 9,
          "title": "Message Types Distribution",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_channel_messages_total[5m])",
              "legendFormat": "Channel Messages",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_direct_messages_total[5m])",
              "legendFormat": "Direct Messages",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_private_group_messages_total[5m])",
              "legendFormat": "Private Group Messages",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_livechat_messages_total[5m])",
              "legendFormat": "Livechat Messages",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 9.5,
          "title": "Messages per Second",
          "description": "Real-time message rate across all channels and message types.",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_messages_total[5m])",
              "legendFormat": "Total Messages/sec",
              "maxDataPoints": 100,
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "reqps",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 10,
          "title": "Room Statistics",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_channels_total",
              "legendFormat": "Channels",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_private_groups_total",
              "legendFormat": "Private Groups",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_direct_total",
              "legendFormat": "Direct Messages",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_livechat_total",
              "legendFormat": "Livechat",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 11,
          "title": "DDP Sessions",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_ddp_sessions_count",
              "legendFormat": "Total Sessions",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_ddp_sessions_auth",
              "legendFormat": "Authenticated Sessions",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 12,
          "title": "Meteor Methods Performance",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_meteor_methods_sum[5m]) / rate(rocketchat_meteor_methods_count[5m])",
              "legendFormat": "Average Method Time - {{pod}}",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_meteor_methods_count[5m])",
              "legendFormat": "Methods/sec - {{pod}}",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 13,
          "title": "Livechat Performance",
          "description": "Livechat metrics including agent count, visitor activity, and webhook performance. Note: Some metrics may not be available if livechat features are not enabled.",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 40},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_agents_total",
              "legendFormat": "Total Agents",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_visitors_total",
              "legendFormat": "Total Visitors",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_livechat_webhooks_success[5m]) or vector(0)",
              "legendFormat": "Webhook Success Rate",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_livechat_webhooks_failures[5m]) or vector(0)",
              "legendFormat": "Webhook Failure Rate",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 14,
          "title": "Apps & Integrations",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 40},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_apps_installed",
              "legendFormat": "Apps Installed",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_apps_enabled",
              "legendFormat": "Apps Enabled",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_apps_failed",
              "legendFormat": "Apps Failed",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_hooks_count[5m])",
              "legendFormat": "Hooks/sec",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 15,
          "title": "CPU Utilization (%)",
          "description": "CPU usage percentage for each Rocket.Chat pod compared to allocated limits. Monitor for resource saturation.",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 48},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"}[5m])) * 100",
              "legendFormat": "{{pod}} CPU %",
              "maxDataPoints": 100,
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (kube_pod_container_resource_limits{namespace=\"$namespace\", resource=\"cpu\", unit=\"core\", pod=~\"rocketchat-.*\"}) * 100",
              "legendFormat": "{{pod}} CPU Limit %",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 70},
                  {"color": "red", "value": 90}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"}
          }
        },
        {
          "id": 16,
          "title": "Memory Usage vs Limits",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 48},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"})",
              "legendFormat": "{{pod}} Memory Usage",
              "maxDataPoints": 100,
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (kube_pod_container_resource_limits{namespace=\"$namespace\", resource=\"memory\", pod=~\"rocketchat-.*\"})",
              "legendFormat": "{{pod}} Memory Limit",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes",
              "color": {"mode": "palette-classic"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 1073741824},
                  {"color": "red", "value": 2147483648}
                ]
              }
            }
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"}
          }
        },
        {
          "id": 29,
          "title": "CPU Usage Efficiency (%)",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 4, "w": 6, "x": 0, "y": 56},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "avg(sum by (pod) (rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"}[5m])) / sum by (pod) (kube_pod_container_resource_limits{namespace=\"$namespace\", resource=\"cpu\", unit=\"core\", pod=~\"rocketchat-.*\"})) * 100",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "color": {"mode": "thresholds"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "yellow", "value": 30},
                  {"color": "green", "value": 50},
                  {"color": "yellow", "value": 80},
                  {"color": "red", "value": 95}
                ]
              }
            }
          }
        },
        {
          "id": 30,
          "title": "Memory Usage Efficiency (%)",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 4, "w": 6, "x": 6, "y": 56},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "avg(sum by (pod) (container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"}) / sum by (pod) (kube_pod_container_resource_limits{namespace=\"$namespace\", resource=\"memory\", pod=~\"rocketchat-.*\"})) * 100",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "color": {"mode": "thresholds"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "yellow", "value": 30},
                  {"color": "green", "value": 50},
                  {"color": "yellow", "value": 85},
                  {"color": "red", "value": 95}
                ]
              }
            }
          }
        },
        {
          "id": 31,
          "title": "Node CPU Usage",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 4, "w": 6, "x": 12, "y": 56},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "avg(100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100))",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "color": {"mode": "thresholds"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 70},
                  {"color": "red", "value": 85}
                ]
              }
            }
          }
        },
        {
          "id": 32,
          "title": "Node Memory Usage",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 4, "w": 6, "x": 18, "y": 56},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "avg((1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100)",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "decimals": 1,
              "color": {"mode": "thresholds"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 70},
                  {"color": "red", "value": 85}
                ]
              }
            }
          }
        },
        {
          "id": 32.5,
          "title": "Top Resource Consumers",
          "description": "Top 10 Rocket.Chat pods by CPU and memory usage. Helps identify resource-intensive instances.",
          "type": "table",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 60},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "topk(10, sum by (pod) (rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"}[5m])) * 100)",
              "legendFormat": "__auto",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "topk(10, sum by (pod) (container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"}) / 1024 / 1024)",
              "legendFormat": "__auto",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "thresholds"},
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "green", "value": 0},
                  {"color": "yellow", "value": 70},
                  {"color": "red", "value": 90}
                ]
              }
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Time"},
                "properties": [{"id": "displayName", "value": "Pod"}]
              },
              {
                "matcher": {"id": "byName", "options": "Value #A"},
                "properties": [
                  {"id": "displayName", "value": "CPU %"},
                  {"id": "unit", "value": "percent"},
                  {"id": "decimals", "value": 1}
                ]
              },
              {
                "matcher": {"id": "byName", "options": "Value #B"},
                "properties": [
                  {"id": "displayName", "value": "Memory MB"},
                  {"id": "unit", "value": "decbytes"},
                  {"id": "decimals", "value": 0}
                ]
              }
            ]
          },
          "options": {
            "showHeader": true,
            "sortBy": [{"displayName": "CPU %", "desc": true}]
          }
        },
        {
          "id": 33,
          "title": "Resource Usage Trends (24h)",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 68},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "avg(sum by (pod) (rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"}[5m]))) * 100",
              "legendFormat": "Avg CPU Usage % (All Rocket.Chat Pods)",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "avg(sum by (pod) (container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"rocketchat-.*\", image!=\"\"})) / 1024 / 1024",
              "legendFormat": "Avg Memory Usage (MB) - All Rocket.Chat Pods",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"}
            },
            "overrides": [
              {
                "matcher": {"id": "byName", "options": "Avg CPU Usage %"},
                "properties": [{"id": "unit", "value": "percent"}]
              },
              {
                "matcher": {"id": "byName", "options": "Avg Memory Usage (MB)"},
                "properties": [{"id": "unit", "value": "decbytes"}]
              }
            ]
          },
          "options": {
            "tooltip": {"mode": "multi", "sort": "desc"}
          }
        },
        {
          "id": 34,
          "title": "MongoDB Resource Usage",
          "description": "CPU and memory usage for MongoDB pods. Critical for database performance monitoring and capacity planning.",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 68},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", pod=~\"mongodb-.*\", image!=\"\"}[5m])) * 100",
              "legendFormat": "{{pod}} CPU Usage %",
              "maxDataPoints": 100,
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (container_memory_working_set_bytes{namespace=\"$namespace\", pod=~\"mongodb-.*\", image!=\"\"})",
              "legendFormat": "{{pod}} Memory Usage",
              "maxDataPoints": 100,
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "palette-classic"}
            },
            "overrides": [
              {
                "matcher": {"id": "byRegexp", "options": ".*CPU.*"},
                "properties": [{"id": "unit", "value": "percent"}]
              },
              {
                "matcher": {"id": "byRegexp", "options": ".*Memory.*"},
                "properties": [{"id": "unit", "value": "bytes"}]
              }
            ]
          }
        },
        {
          "id": 17,
          "title": "Pod Status",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 76},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "kube_pod_status_phase{namespace=\"$namespace\", phase=\"Running\"}",
              "legendFormat": "{{pod}} Running",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "count(kube_pod_status_phase{namespace=\"rocketchat\", phase=\"Running\"})",
              "legendFormat": "Total Running Pods (All)",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 18,
          "title": "Pod Restarts",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 76},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "increase(kube_pod_container_status_restarts_total{namespace=\"$namespace\"}[5m])",
              "legendFormat": "{{pod}}/{{container}} Restarts",
              "maxDataPoints": 100,
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 19,
          "title": "MongoDB Status",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 0, "y": 84},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "count(kube_pod_status_phase{namespace=\"$namespace\", pod=~\"mongodb-[0-9]+.*\", phase=\"Running\"})",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"}
            }
          }
        },
        {
          "id": 20,
          "title": "Log Ingest Rate (Loki)",
          "type": "timeseries",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 6, "x": 6, "y": 84},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum(rate({namespace=\"${namespace}\"}[5m]))",
              "legendFormat": "Logs/sec",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"},
              "decimals": 2
            }
          }
        },
        {
          "id": 21,
          "title": "Notifications Sent",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 84},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_notification_sent[5m])",
              "legendFormat": "Notifications/sec - {{pod}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 22,
          "title": "Rocket.Chat Application Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 12, "w": 24, "x": 0, "y": 96},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"${namespace}\", pod=~\"rocketchat-rocketchat.*\"} |= \"\"",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            },
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"${namespace}\", app!=\"mongodb\"} |= \"\"",
              "refId": "B",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none",
            "sortOrder": "Descending"
          }
        },
        {
          "id": 23,
          "title": "Error Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 96},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"${namespace}\"} |~ \"(?i)(error|exception|failed|fatal|panic)\"",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none",
            "sortOrder": "Descending"
          }
        },
        {
          "id": 24,
          "title": "MongoDB Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 96},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\", app=\"mongodb\"} |= \"\"",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none",
            "sortOrder": "Descending"
          }
        },
        {
          "id": 25,
          "title": "Log Volume by Service",
          "type": "timeseries",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 104},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum by (app) (rate({namespace=\"rocketchat\", app!=\"mongodb\"}[5m]))",
              "legendFormat": "{{app}}",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"},
              "decimals": 3
            }
          }
        },
        {
          "id": 26,
          "title": "Log Level Distribution",
          "type": "timeseries",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 104},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum by (level) (rate(({namespace=\"rocketchat\", app!=\"mongodb\"} | regexp \"(?i)\\\\b(?P<level>debug|info|warn|warning|error|fatal)\\\\b\") [5m]))",
              "legendFormat": "{{level}}",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"},
              "decimals": 3
            }
          }
        },
        {
          "id": 26.5,
          "title": "Log Levels Heatmap",
          "description": "Visual heatmap showing log level patterns over time. Darker colors indicate higher frequency of specific log levels.",
          "type": "heatmap",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 24, "x": 0, "y": 108},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum by (level) (rate(({namespace=\"rocketchat\", app!=\"mongodb\"} | regexp \"(?i)\\\\b(?P<level>debug|info|warn|warning|error|fatal)\\\\b\") [5m]))",
              "legendFormat": "{{level}}",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "color": {"mode": "scheme", "scheme": "Viridis"}
            }
          },
          "options": {
            "calculate": false,
            "cellGap": 1,
            "cellValues": {},
            "cellValuesByCount": null,
            "color": {
              "exponent": 0.5,
              "fill": "dark-orange",
              "mode": "scheme",
              "reverse": false,
              "scale": "exponential",
              "scheme": "Viridis",
              "steps": 64
            },
            "exemplars": {
              "color": "rgba(255,0,255,0.7)"
            },
            "filterValues": {
              "le": 1e-9
            },
            "legend": {
              "show": true
            },
            "rowsFrame": {
              "layout": "auto",
              "value": "Time"
            },
            "tooltip": {
              "show": true,
              "yHistogram": false
            },
            "yAxis": {
              "axisPlacement": "left",
              "reverse": false,
              "unit": "short"
            }
          }
        },
        {
          "id": 27,
          "title": "Recent Alerts & Warnings",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 120},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\", app!=\"mongodb\"} |~ \"(?i)(alert|warning|warn|critical|urgent)\"",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none",
            "sortOrder": "Descending"
          }
        },
        {
          "id": 28,
          "title": "Performance Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 120},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\", app!=\"mongodb\"} |~ \"(?i)(slow|timeout|latency|performance|memory|cpu)\"",
              "refId": "A",
              "resolution": 1,
              "editorMode": "code"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none",
            "sortOrder": "Descending"
          }
        }
      ],
      "templating": {
        "list": [
          {
            "current": {
              "selected": true,
              "text": "rocketchat",
              "value": "rocketchat"
            },
            "hide": 0,
            "includeAll": false,
            "label": "Environment",
            "multi": false,
            "name": "namespace",
            "options": [
              {
                "selected": true,
                "text": "Production (rocketchat)",
                "value": "rocketchat"
              },
              {
                "text": "Development (dev-rocketchat)",
                "value": "dev-rocketchat"
              },
              {
                "text": "Staging (staging-rocketchat)",
                "value": "staging-rocketchat"
              },
              {
                "text": "QA (qa-rocketchat)",
                "value": "qa-rocketchat"
              }
            ],
            "query": "",
            "queryValue": "",
            "skipUrlSync": false,
            "type": "custom"
          },
          {
            "current": {
              "selected": true,
              "text": "All",
              "value": "$__all"
            },
            "hide": 0,
            "includeAll": true,
            "label": "Pod Filter",
            "multi": true,
            "name": "pod_filter",
            "options": [
              {
                "selected": true,
                "text": "All",
                "value": "$__all"
              }
            ],
            "datasource": {"type": "prometheus", "uid": "prometheus"},
            "query": "label_values(kube_pod_info{namespace=\"$namespace\"}, pod)",
            "queryValue": "",
            "skipUrlSync": false,
            "type": "query"
          }
        ]
      },
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {"type": "grafana", "uid": "-- Grafana --"},
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          },
          {
            "datasource": {"type": "prometheus", "uid": "prometheus"},
            "enable": false,
            "expr": "kube_deployment_created{namespace=\"$namespace\"}",
            "hide": false,
            "iconColor": "green",
            "name": "Deployments",
            "tags": ["deployment", "kubernetes"],
            "type": "annotation"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "weekStart": ""
    }
