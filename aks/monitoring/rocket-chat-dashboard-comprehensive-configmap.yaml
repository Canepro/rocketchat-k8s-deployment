apiVersion: v1
kind: ConfigMap
metadata:
  name: rocket-chat-dashboard-comprehensive
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  rocket-chat-dashboard-comprehensive.json: |
    {
      "uid": "rocketchat-comprehensive",
      "title": "Rocket.Chat Comprehensive Production Monitoring",
      "tags": ["rocket-chat", "production", "monitoring", "comprehensive"],
      "timezone": "browser",
      "schemaVersion": 39,
      "version": 1,
      "refresh": "30s",
      "time": {"from": "now-2h", "to": "now"},
      "panels": [
        {
          "id": 1,
          "title": "Rocket.Chat Uptime SLO",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "editorMode": "code",
              "expr": "avg(up{job=~\".*rocketchat.*\"}) * 100",
              "range": true,
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {"color": "red", "value": 0},
                  {"color": "yellow", "value": 95},
                  {"color": "green", "value": 99}
                ]
              }
            },
            "overrides": []
          }
        },
        {
          "id": 2,
          "title": "Active Users",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_active",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"}
            }
          }
        },
        {
          "id": 3,
          "title": "Total Users",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_total",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"}
            }
          }
        },
        {
          "id": 4,
          "title": "Messages per Second",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_messages_total[5m])",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "decimals": 2
            }
          }
        },
        {
          "id": 5,
          "title": "User Status Distribution",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_online",
              "legendFormat": "Online",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_away",
              "legendFormat": "Away",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_users_offline",
              "legendFormat": "Offline",
              "refId": "C"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 6,
          "title": "DDP Connected Users",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_ddp_connected_users",
              "legendFormat": "Connected Users",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 7,
          "title": "API Response Time",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_rest_api_sum[5m]) / rate(rocketchat_rest_api_count[5m])",
              "legendFormat": "Average Response Time",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_messages_roundtrip_time_summary{quantile=\"0.95\"}",
              "legendFormat": "95th Percentile",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 8,
          "title": "API Request Rate",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_rest_api_count[5m])",
              "legendFormat": "Requests/sec",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "reqps",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 9,
          "title": "Message Types Distribution",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_channel_messages_total[5m])",
              "legendFormat": "Channel Messages",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_direct_messages_total[5m])",
              "legendFormat": "Direct Messages",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_private_group_messages_total[5m])",
              "legendFormat": "Private Group Messages",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_livechat_messages_total[5m])",
              "legendFormat": "Livechat Messages",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 10,
          "title": "Room Statistics",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_channels_total",
              "legendFormat": "Channels",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_private_groups_total",
              "legendFormat": "Private Groups",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_direct_total",
              "legendFormat": "Direct Messages",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_livechat_total",
              "legendFormat": "Livechat",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 11,
          "title": "DDP Sessions",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_ddp_sessions_count",
              "legendFormat": "Total Sessions",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_ddp_sessions_auth",
              "legendFormat": "Authenticated Sessions",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 12,
          "title": "Meteor Methods Performance",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_meteor_methods_sum[5m]) / rate(rocketchat_meteor_methods_count[5m])",
              "legendFormat": "Average Method Time",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_meteor_methods_count[5m])",
              "legendFormat": "Methods/sec",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 13,
          "title": "Livechat Performance",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 40},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_agents_total",
              "legendFormat": "Total Agents",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_visitors_total",
              "legendFormat": "Total Visitors",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_livechat_webhooks_success[5m])",
              "legendFormat": "Webhook Success Rate",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_livechat_webhooks_failures[5m])",
              "legendFormat": "Webhook Failures",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 14,
          "title": "Apps & Integrations",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 40},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_apps_installed",
              "legendFormat": "Apps Installed",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_apps_enabled",
              "legendFormat": "Apps Enabled",
              "refId": "B"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rocketchat_apps_failed",
              "legendFormat": "Apps Failed",
              "refId": "C"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_hooks_count[5m])",
              "legendFormat": "Hooks/sec",
              "refId": "D"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 15,
          "title": "Infrastructure Health",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 48},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (rate(container_cpu_usage_seconds_total{namespace=\"rocketchat\", pod=~\"rocketchat-.*\", image!=\"\"}[5m]))",
              "legendFormat": "{{pod}} CPU",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 16,
          "title": "Memory Usage",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 48},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "sum by (pod) (container_memory_working_set_bytes{namespace=\"rocketchat\", pod=~\"rocketchat-.*\", image!=\"\"})",
              "legendFormat": "{{pod}} Memory",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "bytes",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 17,
          "title": "Pod Status",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 56},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "kube_pod_status_phase{namespace=\"rocketchat\", phase=\"Running\"}",
              "legendFormat": "{{pod}} Running",
              "refId": "A"
            },
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "count(kube_pod_status_phase{namespace=\"rocketchat\", phase=\"Running\"})",
              "legendFormat": "Total Running Pods",
              "refId": "B"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 18,
          "title": "Pod Restarts",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 56},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "increase(kube_pod_container_status_restarts_total{namespace=\"rocketchat\"}[5m])",
              "legendFormat": "{{pod}}/{{container}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 19,
          "title": "MongoDB Status",
          "type": "stat",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 6, "x": 0, "y": 64},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "count(kube_pod_status_phase{namespace=\"rocketchat\", pod=~\"mongodb-[0-9]+.*\", phase=\"Running\"})",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "thresholds"}
            }
          }
        },
        {
          "id": 20,
          "title": "Log Ingest Rate (Loki)",
          "type": "timeseries",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 6, "x": 6, "y": 64},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum(rate({namespace=\"rocketchat\"}[1m]))",
              "legendFormat": "Logs/sec",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 21,
          "title": "Notifications Sent",
          "type": "timeseries",
          "datasource": {"type": "prometheus", "uid": "prometheus"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 64},
          "targets": [
            {
              "datasource": {"type": "prometheus", "uid": "prometheus"},
              "expr": "rate(rocketchat_notification_sent[5m])",
              "legendFormat": "Notifications/sec",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 22,
          "title": "Rocket.Chat Application Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 12, "w": 24, "x": 0, "y": 72},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\", container=~\"rocketchat.*\"} |= \"\"",
              "refId": "A"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none"
          }
        },
        {
          "id": 23,
          "title": "Error Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 84},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\"} |~ \"(?i)(error|exception|failed|fatal|panic)\"",
              "refId": "A"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none"
          }
        },
        {
          "id": 24,
          "title": "MongoDB Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 84},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\", container=~\"mongodb.*\"} |= \"\"",
              "refId": "A"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none"
          }
        },
        {
          "id": 25,
          "title": "Log Volume by Service",
          "type": "timeseries",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 92},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum by (container) (rate({namespace=\"rocketchat\"}[5m]))",
              "legendFormat": "{{container}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 26,
          "title": "Log Level Distribution",
          "type": "timeseries",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 92},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "sum by (level) (rate({namespace=\"rocketchat\"} |~ \"level=(debug|info|warn|error|fatal)\" [5m]))",
              "legendFormat": "{{level}}",
              "refId": "A"
            }
          ],
          "fieldConfig": {
            "defaults": {
              "unit": "short",
              "color": {"mode": "palette-classic"}
            }
          }
        },
        {
          "id": 27,
          "title": "Recent Alerts & Warnings",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 0, "y": 100},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\"} |~ \"(?i)(alert|warning|warn|critical|urgent)\"",
              "refId": "A"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none"
          }
        },
        {
          "id": 28,
          "title": "Performance Logs",
          "type": "logs",
          "datasource": {"type": "loki", "uid": "loki"},
          "gridPos": {"h": 8, "w": 12, "x": 12, "y": 100},
          "targets": [
            {
              "datasource": {"type": "loki", "uid": "loki"},
              "expr": "{namespace=\"rocketchat\"} |~ \"(?i)(slow|timeout|latency|performance|memory|cpu)\"",
              "refId": "A"
            }
          ],
          "options": {
            "showTime": true,
            "showLabels": true,
            "showCommonLabels": false,
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true,
            "dedupStrategy": "none"
          }
        }
      ],
      "templating": {
        "list": []
      },
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {"type": "grafana", "uid": "-- Grafana --"},
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "liveNow": false,
      "weekStart": ""
    }
